---
title: "Developing Data Products Notes"
author: "Coursera Course by John Hopkins University"
date: "INSTRUCTORS: Dr. Brian Caffo, Dr. Jeff Leek, Dr. Roger D. Peng"
fontsize: 11pt
output: 
  pdf_document:
    toc: true
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Intro  


## Github Link for Lectures  
**[Developing Data Products' lectures on GitHub](https://github.com/DataScienceSpecialization/Developing_Data_Products)**  

## Course Book  
**[The book for this course is available on leanpub](https://leanpub.com/ddp)** 

## Instructor's Note  
"*This course is about building tools for improving the data analysis process, making data driven decisions, or for other infrastructure that supports other data products...*  
*To preview some of the topics we'll be covering. With the R Markdown package you can create websites, PDFs, presentations, and even e-books from a single file in R in a way that you're very comfortable and familiar with. We'll teach the latest features of the Shiny package which you can use to create interactive web applications in R. We'll talk about interactive graphics using Plotly and Leaflet which allows you to create beautiful maps that you can share online. We'll do similar things with the package GoogleViz which allows you to create maps and interactive graphics and tables. We've also added how to use swirl and swirlify to design courses in R so that you can share your knowledge...*  
  
*- Brian Caffo and the Data Science Track Team*"


# Shiny, GoogleVis, and Plotly  
## Shiny Part 1  

### Shiny Overview (1.1)  
#### What is Shiny?  
* Shiny is a web development framework in R, meaning one only needs to know R to use it.  
  + Helps one get around a possible lack of resources or knowledge in JavaScipt, HTML, etc.  

* Shiny needs a server to run on  
  + One can use their own, RStudio's limited free hosting service, or something like Amazon AWS. RStudio also has a paid version of their service.  
* Shiny application vs. Shiny server  
  + Apps a ran locally and use RStudio's service for hosting the app on their servers, on a platform called shinyapps.io  
    - the free version only allows one to run 5 apps for a certain amount of time per month  
    - RStudio will send one a message if the limit is reached  
    - Should one hit the 25-hour per month limit they can send an email to *shinyapps-support@rstudio.com* to request an increase in their limit so one can continue working on thier project (for this course)  
  + A Shiny server is required such that one can host a shiny app for the world  
    - It requires understanding a little linux server administration and won't be covered in this course.  

* Although everything is done in R it is helpful to have some knowledge of HTML to know what the commands in R are actually doing.  
* Shiny uses `Bootstrap` (no relation to the statistical method) style, which suffices for aesthetics, rendering, and resizing to fit different screens.    

#### HTML, CSS, and Javascript Tutorials  
* **[Mozilla Developer Network Tutorials](https://developer.mozilla.org/en-US/docs/Web/Tutorials)**  
* **[HTML & CSS from Khan Academy](https://www.khanacademy.org/computing/computer-programming/html-css)**  
* **[Tutorials from Free Code Camp](https://www.freecodecamp.com/)**

#### A Shiny Project  
* There is **[a tutorial for shiny on RStudio](https://shiny.rstudio.com/tutorial/)**, however these notes will sort of walk through that tutorial anyway.  
* A computer interfaces with the app to generate new plots/results based on the users' input on the app.  
* A shiny project consists of a directory with at least two files:  
  + `ui.R` (for user interface) controls how your app looks.  
  + `server.R` that controls what your app does, held on the server.  
  + NOTE: The app doesn't actually need these two files but rather the functions the contain, as such it's also an option to just have a `app.R` file.  
* **[RStudio has some examples of shiny apps too](https://shiny.rstudio.com/gallery/#user-showcase)**  

* I also found someone **[made a game using Shiny](https://towardsdatascience.com/is-r-shiny-versatile-enough-to-build-a-video-game-5c93232ef4e2)**. The game's app also contains **[a link to the GitHub repo.](https://github.com/pedrocoutinhosilva/shiny.decisions/tree/master/src/app)**  


### Shiny Code Demos (1.2)  
A demo is located in `./helloShiny`  

#### Set-Up  

![New File](./Images/New_Shiny_App.png)  
  
![Create app in GUI](./Images/create_app.png)  
  
  

#### ui.R  
* requires the function `shinyUI`  
  + `fluidPage(` by default has a main panel, `mainPanel(` and a sidebar panel, `sidebarLayout(sidebarPanel(`  

#### server.R  
* requires the function `shinyServer`  
  + Any logical computations are done here



### Shiny HTML Tags (1.3)  
* Shiny provides several wrapper functions for using standard HTML tags in your `ui.R`, including:  
  + `h1()` through `h6()` for headlines  
  + `p()` for paragraphs  
  + `br()` for line-breaks  
  + `a()` for inserting hyperlinks  
  + `div()` denotes a section styled with CSS  
  + `span()` to color a part of the text  
  + See the help page, `?builder` for more details.  
  + A guide of HTML tags **[can be found on this site](https://www.w3schools.com/tags/)**  
  
* Some of these tags are tested in `./helloShiny/`  

### Shiny Apps with I/O (1.4)  
* In this first demo we'll be looking at a slider input, which will just show the value to the user. This demo is found in `./helloSlider/`  


### Shiny Apps with Plots (1.5)
* Allowing users to manipulate data nd see the reults of their manipulations as a plot can be very useful  
* Shiny provides the `plotOutput()` function for `ui.R`  
* ...and the `renderPlot()` function for `sever.R`  
* The demo of this is in `./helloPlot/`  
* Also contains: 
  + in/de-crementing arrows for a textbox  
  + checkboxes for a logical if labels are present  
  


**Reminder to Commit (01), Delete this line** ***AFTER*** **Committing**  

## Shiny Part 2  

### Reactivity (2.1)  
* A reactive expression manipulates inputs from Shiny and returns a value.  
* Reactivity provides a way for your app to respond, as inputs will change depending on how users interact with your UI  
* Expressions that are subject to change should be wrapped with the function `reactive()`  
  + Because of the syntax of Shiny this may look a bit "unorthodox" for R code (Having `({...})`)  
* Creating a reactive expression is like creating a function:  
```{r eval = FALSE}
calc_sum <- reactive({
  input$box1 + input$box2
})

# ...

calc_sum()
```

* Later we'll look at having the user push a button to have the app react, which is helpful for more computational heavy computations.  

### `reactive` Example (2.2)  
* An example that uses the `reactive` function can be found in `./helloReactive/`  


### Delayed Reactivity (2.3)  
* One may not want an app to immediately react to changes in user input, such as in cases of long-running calculation
* In order to prevent reactive expressions from reacting one can include a submit button in the app.  
* An example of this can be found in `./helloSubmit/`, which is a "fork" of `./helloReactive/` but with the submit button (only comments about the submit button are present in this document).    

### Tabs (2.4)  
* There are several other kinds of UI components that one can add to an app, such as tabs  
  + tabs - gives app multiple views  
  + navbars - to click around multiple tabs, like a top menu  
  + sidebars - just like navbars but on the side  
  
* There are functions for managing these tabs:  
  + `tabsetPanel()` - specifies a group of tabs  
  + `tabPanel()` - specifies the contents of an individual tab  

* An example of tabs can be found in `./helloTabs/`    

### Using your own HTML (2.5)  
* To use custom HTML one would save the code as `index.html` in a directory, named `www`, which is a child of the directory containing the `server.R` file  
* Most of the style from Shiny's bootstrap setup in the header will no longer be needed

### Interactive Graphics (2.6)  
* A feature of Shiny is the ability to create graphics that a user can interact with.  
* One method that can be used to select multiple data points on a graph is by specifying the `brush` parameter in `plotOutput()` in the `ui.R` file, then using the `brushedPoints()` function in the `server.R` file.  
* The `./helloBrush/` directory gives an example that draws a line of best fit, given user selected points.  


## Shiny Gadgets  

### Overview (1.1)  
* Shiny Gadgets provide a way to use Shiny's interactivity and UI as a part of a data analysis.  
* A function is created that opens a small Shiny app in the RStudio viewer pane
  + Since it's smaller we use the `miniUI` package for manipulating the GUI  
  + A gadget is a singular function that contains it's own  `ui` and `server` functions.  
* An example of a gadget to use can be found in `myFirstGadget.R` (were you expecting `helloGadget`?), the function's code is displayed below.  
```{r}
library(shiny)
library(miniUI)

myFirstGadget <- function() {
    ui <- miniPage(
        gadgetTitleBar("My First Gadget")
    )
    server <- function(input, output, session) {
        # Put in a Done button to close the app
        observeEvent(input$done, {
            stopApp()
        })
    }
    runGadget(ui,server)
}
```


### Shiny Gadgets (1.2)  
* An advantage of Shiny Gadgets is that since theya re functions they can take values as arguments and then return values.  
* We'll create a simple example of a Gadget that has I/O  
  + It will take two different vectors of numbers as arguments & use them to populate two `selectInput`s. The user can then choose two numbers within the Gadget and their product will be returned  
  + (Note: I won't be creating a separate file for this one)
```{r}
library(shiny)
library(miniUI)

multiplyNumbers <- function(numbers1, numbers2) {
  ui <- miniPage(
    gadgetTitleBar("Multiply Two Numbers"),
    miniContentPanel(
      #Make two drop-down boxes of selection options
      selectInput("num1", "First Number", choices = numbers1),
      selectInput("num2", "Second Number", choices = numbers2)
    )
  )
  
  server <- function(input, output, session) {
    observeEvent(input$done, {
                 num1 <- as.numeric(input$num1)
                 num2 <- as.numeric(input$num2)
                 stopApp(num1 * num2)
                 })
  }
  runGadget(ui, server)
}
```


### Gadgets with Interactive Graphics (1.3)  
* Gadgets can be used to create interactive plots, which can be helpful during the exploratory process or presentation of data.  
* Below we'll be looking at an example of this.  
```{r}
library(shiny)
library(miniUI)

pickTrees <- function() {
  #User Interface
  ui <- miniPage(
    #Title
    gadgetTitleBar("Select Points by Dragging your Mouse"),
    #Show plot with brush interaction
    miniContentPanel(
      plotOutput("plot", #Plot is named "plot"
                 height = "100%", brush = "brush") #Brush is named "brush"
    )
  )
  
  #Logic
  server <- function(input, output, session) {
    #Display plot
    output$plot <- renderPlot({
      plot(trees$Girth, trees$Volume, main = "Trees!",
           xlab = "Girth", ylab = "Volume")
    })
    
    #On Done button, get selected points & print df of selection to console
    observeEvent(input$done, {
      stopApp(brushedPoints(trees, input$brush,
                            xvar = "Girth", yvar = "Volume"))
    })
  }
  
  runGadget(ui, server)
}
```

* The original data frame row numbers are retained, as such this can be helpful to quickly identify outliers in one's data


## GoogleVis  
### GoogleVis (1.1)  
* `googleVis` is a package that connects R to Google's visualization API  
* Allows one to create visuals that would otherwise be difficult to create without it.  
* googleVis charts can be embedded into the HTML when using Knitter too  
* Btw googleVis uses flash, so unless they change something this will be obsolete after browsers stop supporting flash entirely.  
  + Maybe check out the suggested packages in the answer to **[this StackOverflow question.](https://stackoverflow.com/questions/17786043/alternative-for-googlevis-in-r)**  

#### Motion Chart Example  
```{r message = FALSE}
library(googleVis)
M <- gvisMotionChart(Fruits, #Example data included with GVis
                     idvar = "Fruit", timevar = "Year")

#To view the chart in a web browser with flash from Command line use
# plot(M)
# print(M, "chart") #prints HTML to run flash
```


### Charts in googleVis (1.2)  
* Motion charts: `gvisMotionChart`  
* Interactive maps: `gvisGeoChart`  
* Interactive tables: `gvisTable`  
* Line charts: `gvisLineChart`  
* Bar charts: `gvisColumnChart`  
* Tree maps: `gvisTreeMap`  
* **[The full documentation can be fround on CRAN](http://cran.r-project.org/web/packages/googleVis/googleVis.pdf)**  

#### Plots on Maps Example  
```{r}
G <- gvisGeoChart(Exports, 
                  locationvar = "Country", colorvar = "Profit")
# plot(G) #Commented out because... flash
```
* **[Options that can be used with googleVis can be found here](https://developers.google.com/chart/interactive/docs/gallery/geochart)** (**[Archived here, just in case](https://web.archive.org/web/20200416200251if_/https://developers.google.com/chart/interactive/docs/gallery/geochart)**)  

#### Combing Multiple Plots Together  
```{r}
G <- gvisGeoChart(Exports, "Country", "Profit")
T1 <- gvisTable(Exports)
M <- gvisMotionChart(Fruits, "Fruit", "Year")
GT <- gvisMerge(G, T1, horizontal = FALSE) #Vertical combo (like cbind)
GTM <- gvisMerge(GT, M, horizontal = TRUE, #Horizontal combo
                 tableOptions = "bgcolor=\"#CCCCCC\" cellspacing=10")
#plot(GTM)
```

#### Viewing the HTML code  
```{r eval = FALSE, echo = TRUE}
M <- gvisMotionChart(Fruits, "Fruit", "Year")

#View locally (setting results = "asis" in Rmd would 
# make the HTML code paste right in)
print(M)

# Save HTML to a file  
print(M, 'chart', file = "myfilename.html")
```

#### Things You Can do with Google Vis  
* The visualizations can be embedded in websites with HTML code  
* Dynamic visualizations can be built with `Shiny`, `Rook`, and `R.rsp`  
* Embed them in R markdown based documents  
  + Set `results="asis"` in the chunk options  
  * Can be used with `kniter` and `slidify`  
  + Sometimes clearing `kniter` cache can help the (static) charts display  
  
#### For More Info  
* `demo(googleVis)` will show off some plots... using flash when needed  
* **[CRAN vignette](http://cran.r-project.org/web/packages/googleVis/vignettes/googleVis.pdf)**  
* **[CRAN package info](http://cran.r-project.org/web/packages/googleVis/googleVis.pdf)**  
* **[Google's documentation](https://developers.google.com/chart/interactive/docs/gallery)**  
* **[Google's FAQ](https://developers.google.com/chart/interactive/faq)**  

## Plotly  
### Plotly Intro (1.1)  
* `Plotly` is helpful for creating interactive web graphics with R  
* Can integrate with a lot of other languages too, such as: R, Python, MatLab, JavaScript, and Microsoft Excel.   
* To share visualizations online one will need an account on **[the plotly site](https://plotly.com/)**  
* However the `plotly` package will let one just make HTML graphics independent of the plotly site
* Outputs from `knitr` that warrant for interaction will allow interaction with `plotly` plots 


### Basic Scatter Plot (1.2)  
* A scatter plot is indicated with the parameter `mode = "markers"`  
```{r message = FALSE}
library(plotly)
plot_ly(data = mtcars, x = ~wt, y = ~mpg, # '~' is needed to refer to vars
        mode = "markers") # Designates a scatter plot
```



### Adding Qualatative Variables (1.3)  
#### Discreet Color  
```{r message=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, mode = "markers",
        color = ~as.factor(cyl))#Color by cylinder type
```

#### Continuous Color  
```{r message=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, mode = "markers",
        color = ~disp)#Color by displacement, a continuous varaible
```
  
#### Altering Size  
```{r message=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, mode = "markers",
        color = ~as.factor(cyl), size = ~hp)
```

#### 3D Scatter Plot  
* A three-dimensional scatterplot can be created with the `type = "scatter3d"` argument.  
  + These plots can be clicked and dragged to view different angles  
* Uses WebGL to create interactive 3D graphics in a web page
```{r message = FALSE}
set.seed(1618033)
temp <- rnorm(100, mean = 30, sd = 5)
pressure <- rnorm(100)
dtime <- 1:100

plot_ly(x = temp, y = pressure, z = dtime,
        type = "scatter3d", #For 3D plot
        mode = "markers", #Plot type still needs to be denoted
        color = temp) #Qualities can still be applied
```


### Line Graphs (1.4)  
#### Standard Line Graph Example  
* Default for `plot_ly` is to make a scatter plot, so the argument `mode = "line"` has to be passed.  
```{r message = FALSE}
data("airmiles")
head(cbind(time(airmiles), airmiles))
plot_ly(x = time(airmiles), y = airmiles, mode = "line")
```

#### Multi Line Graph - Stock Example  
* Multiple lines can be shown by specifying the column in the data frame that separates the lines  
```{r message = FALSE}
library(plotly)
library(tidyr)
library(dplyr)
library(reshape2)
data("EuStockMarkets")

stocks <- as.data.frame(EuStockMarkets) %>%
  melt(value.name = "price") %>%
  mutate(index = variable,
         time = rep(time(EuStockMarkets), 4))
head(stocks)
plot_ly(stocks, x = ~time, y = ~price, color = ~index, mode = "line")
```


### Other Plots (1.5)  
#### Histogram  
* Use the `type = "histogram"` argument  
```{r message = FALSE}
plot_ly(x = ~precip, type = "histogram")
```

#### Boxplot  
* Use the `type = "box"` argument  
```{r message = FALSE}
plot_ly(iris, y = ~Petal.Length, color = ~Species, type = "box")
```

#### Heatmap  
* Use the `type = "heatmap"` argument  
```{r}
set.seed(1618033)
terrain1 <- matrix(rnorm(100*100), nrow = 100, ncol = 100)
plot_ly(z = terrain1, type = "heatmap")
```

#### 3D Surface  
* Create move-able 3D surfaces with `type = "surface"`  
```{r message = FALSE}
set.seed(1618)
terrain2 <- matrix(sort(rnorm(100*100)), nrow = 100, ncol = 100)
plot_ly(z = terrain2, type = "surface")
```


### Choropleth Maps (1.6)  
* Geographical maps with regions colored by a variable  
```{r message = FALSE}
# Create data frame
state_pop <- data.frame(State = state.abb, Pop = as.vector(state.x77[,1]))
#Create hover text
state_pop$hover <- with(state_pop, paste(State, "<br>", "Population:", Pop))
head(state_pop)

#Make state borders red
borders <- list(color = toRGB("#FF0000"))

#Set up some mapping options  
map_options <- list(
  scope = "USA",
  projection = list(type = "albers usa"),
  showlakes = TRUE,
  lakecolor = toRGB("#FFFFFF")
)

#Create plot 
plot_ly(state_pop, z = ~Pop, text = ~hover, #text displayed when hovered over
        locations = ~State,
        type = "choropleth",
        locationmode = "USA-states",
        color = ~Pop, colors = "Blues", marker = list(line = borders)) %>%
  layout(title = "US Population in 1975", geo = map_options)
```


### Displaying ggplots with Plotly (1.7)  
```{r message = FALSE}
set.seed(100)
d <- diamonds[sample(nrow(diamonds), 1000), ]
p <- ggplot(data = d, aes(x = carat, y = price)) +
  geom_point(aes(text = paste("Clarity:", clarity)), size = 4) +
  geom_smooth(aes(colour = cut, fill = cut)) + facet_wrap(~ cut)

(gg <- ggplotly(p))
```


### Posting to Plotly (1.8)  
* With a saved plotly plot, `gg` in this case, one wants to execute `plotly_POST(gg)`, however you have to have an authentication API established:
```{r eval = FALSE, echo = TRUE}
Sys.setenv("plotly_username" = "your_plotly_username")
Sys.setenv("plotly_api_key" = "your_api_key")
```
  + One can save these commands in their `.Rprofile` file to run everytime R is started  

* Extra note: For kniting PDFs one can see **[this StackOverflow post for instructions](https://stackoverflow.com/questions/40268152/plotly-as-png-in-knitr-rmarkdown)**  

**Reminder to Commit (05), Delete this line** ***AFTER*** **Committing**  

## Quiz 1  
1. 


2. 


3. 


4. 


5. 


**Reminder to Commit (Q1), Delete this line** ***AFTER*** **Committing**  


# R Markdown and Leaflet  
## R Markdown  


### R Markdown (1.1)  


### R Markdown (1.2)  


### R Markdown (1.3)  


### R Markdown (1.4)  


### R Markdown (1.5)  


### R Markdown (1.6)  


### Sharing R Markdown Documents  


**Reminder to Commit (06), Delete this line** ***AFTER*** **Committing**  

## Leaflet  


### Leaflet (1.1)  


### Leaflet (1.2)  


### Leaflet (1.3)  


### Leaflet (1.4)  


### Leaflet (1.5)  


### Leaflet (1.6)  


**Reminder to Commit (07), Delete this line** ***AFTER*** **Committing**  

## Quiz 2  
1. 


2. 


3. 


4. 


5. 


6. 


**Reminder to Commit (Q2), Delete this line** ***AFTER*** **Committing**  


## Course Project 1  



**Reminder to Commit (P1), Delete this line** ***AFTER*** **Committing**  

# Building R Packages  

## R Packages  

### R Packages Overview  


### R Packages (1.1)  


### R Packages (1.2)  


### Building R Packages Demo  



**Reminder to Commit (08), Delete this line** ***AFTER*** **Committing**  

## R Classes and Methods  
### R Classes and Methods (1.1)  


### R Classes and Methods (1.2)  


**Reminder to Commit (09), Delete this line** ***AFTER*** **Committing**  

## Quiz 3  
1. 


2. 


3. 


4. 



**Reminder to Commit (Q3), Delete this line** ***AFTER*** **Committing**  


## Course Project 2  


**Reminder to Commit (P2), Delete this line** ***AFTER*** **Committing**  


# Swirl  
## Swirl  
### Swirl (1.1)  


### Swirl (1.2)  


### Swirl (1.3)  



**Reminder to Commit (10), Delete this line** ***AFTER*** **Committing**  

## Course Project 3  


**Reminder to Commit (P3), Delete this line** ***BEFORE*** **Committing**  




